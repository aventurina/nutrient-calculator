<!--
 * File: nutrient-calculator.html
 * Author: Aimee Venturina
 * Date: May 3, 2025
 * Description: This page is a simple web-based Nutrient Calculator that lets users search for food items
 * and view their nutritional information using the USDA FoodData Central API.
-->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nutrient Calculator</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #f8f9fa;
    }

    .calculator {
      max-width: 700px;
      margin: 50px auto;
    }
  </style>
</head>

<body>

  <div class="container calculator">
    <div class="card shadow p-4">
      <h2 class="mb-3">Nutrient Calculator (USDA API)</h2>

      <div class="mb-3">
        <label for="food" class="form-label">Food Item</label>
        <input type="text" class="form-control" id="food" placeholder="e.g., apple, rice, chicken breast" />
      </div>

      <div class="mb-3">
        <label for="quantity" class="form-label">Quantity (grams)</label>
        <input type="number" class="form-control" id="quantity" placeholder="e.g., 100" />
      </div>

      <button class="btn btn-primary w-100" onclick="calculate()">Calculate</button>

      <div id="results-section">
        <div class="results mt-4">
          <h4>Nutrition Facts:</h4>
          <ul class="list-group">
            <li class="list-group-item">Calories: <span id="calories">0</span> kcal</li>
            <li class="list-group-item">Protein: <span id="protein">0</span> g</li>
            <li class="list-group-item">Carbs: <span id="carbs">0</span> g</li>
            <li class="list-group-item">Fat: <span id="fat">0</span> g</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <script src="js/API_KEY.js"></script>
  <script>
    /**
    * Fetches nutrition data from the USDA API
    */
    async function fetchNutritionData(foodName) {
      const url = `https://api.nal.usda.gov/fdc/v1/foods/search?query=${encodeURIComponent(foodName)}&pageSize=1&api_key=${API_KEY}`;
      const response = await fetch(url);
      const data = await response.json();

      // No search result is returned from the API
      if (!data.foods || data.foods.length === 0) {
        throw new Error("Food not found");
      }

      // Logs the first returned result only
      console.log(data.foods[0]);

      return data.foods[0];
    }

    /**
    * Extracts the macro nutrients and calories
    */
    function extractNutrients(foodItem) {
      const nutrients = { calories: 0, protein: 0, carbs: 0, fat: 0 };

      foodItem.foodNutrients.forEach(n => {
        switch (n.nutrientName) {
          case "Energy":
            nutrients.calories = n.value;
            break;
          case "Protein":
            nutrients.protein = n.value;
            break;
          case "Carbohydrate, by difference":
            nutrients.carbs = n.value;
            break;
          case "Total lipid (fat)":
            nutrients.fat = n.value;
            break;
        }
      });

      return nutrients;
    }

    /**
    * Display the nutrients
    */
    function displayNutrients(nutrients, quantity) {
      const scale = quantity / 100;

      document.getElementById("calories").textContent = (nutrients.calories * scale).toFixed(1);
      document.getElementById("protein").textContent = (nutrients.protein * scale).toFixed(1);
      document.getElementById("carbs").textContent = (nutrients.carbs * scale).toFixed(1);
      document.getElementById("fat").textContent = (nutrients.fat * scale).toFixed(1);
    }

    /**
    * Calculates the data
    */
    async function calculate() {
      resetResults();

      const foodName = document.getElementById("food").value.trim();
      const quantity = parseFloat(document.getElementById("quantity").value);

      validateInputFields(foodName, quantity);

      try {
        const foodItem = await fetchNutritionData(foodName);
        const nutrients = extractNutrients(foodItem);

        displayNutrients(nutrients, quantity);
      } catch (err) {
        console.error(err);
        alert("Error fetching nutrition info.");
      }
    }

    /**
    * Checks that the food item and quantity fields
    * are populated and valid.
    */
    function validateInputFields(food, qty) {
      if (!food || isNaN(qty) || qty <= 0) {
        return alert("Enter valid food and quantity.");
      }
    }

    /**
    * Reset the result fields.
    */
    function resetResults() {
      document.getElementById("calories").textContent = "0";
      document.getElementById("protein").textContent = "0";
      document.getElementById("carbs").textContent = "0";
      document.getElementById("fat").textContent = "0";
    }
  </script>

</body>

</html>